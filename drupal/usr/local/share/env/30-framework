#!/bin/bash

export WEB_DIRECTORY=${WEB_DIRECTORY:-docroot}

deprecate_env_var DRUPAL_DATABASE_NAME DATABASE_NAME
deprecate_env_var DRUPAL_DATABASE_USERNAME DATABASE_USER
deprecate_env_var DRUPAL_DATABASE_PASSWORD DATABASE_PASSWORD
deprecate_env_var DRUPAL_DATABASE_PREFIX DATABASE_PREFIX
deprecate_env_var DRUPAL_DATABASE_HOST DATABASE_HOST
deprecate_env_var DRUPAL_DATABASE_PORT DATABASE_PORT
deprecate_env_var DATABASE_HOST_PORT DATABASE_PORT

export DATABASE_NAME=${DATABASE_NAME:-drupaldb}
export DATABASE_USER=${DATABASE_USER:-drupal}
export DATABASE_PASSWORD=${DATABASE_PASSWORD:-drupal}
export DATABASE_PREFIX=${DATABASE_PREFIX:-}
export DATABASE_HOST=${DATABASE_HOST:-database}
# DATABASE_PORT is set upstream

# deprecated
export DRUPAL_DATABASE_ROOT_PASSWORD=${DRUPAL_DATABASE_ROOT_PASSWORD:-}
export DATABASE_ROOT_PASSWORD=${DATABASE_ROOT_PASSWORD:-${DRUPAL_DATABASE_ROOT_PASSWORD}}
export DRUPAL_DATABASE_ROOT_PASSWORD=${DATABASE_ROOT_PASSWORD}

if [ -n "$DATABASE_ROOT_PASSWORD" ]; then
  export DATABASE_ADMIN_USER=${DATABASE_ADMIN_USER:-root}
  export DATABASE_ADMIN_PASSWORD=${DATABASE_ADMIN_PASSWORD:-$DATABASE_ROOT_PASSWORD}
else
  export DATABASE_ADMIN_USER=${DATABASE_ADMIN_USER:-}
  export DATABASE_ADMIN_PASSWORD=${DATABASE_ADMIN_PASSWORD:-}
fi

export DRUPAL_DRUSH_ALIAS=${DRUPAL_DRUSH_ALIAS:-}

export DRUPAL_SYNC_SSH_KEY_NAME=${DRUPAL_SYNC_SSH_KEY_NAME:-}
export DRUPAL_SYNC_SSH_PRIVATE_KEY=${DRUPAL_SYNC_SSH_PRIVATE_KEY:-}
export DRUPAL_SYNC_SSH_PUBLIC_KEY=${DRUPAL_SYNC_SSH_PUBLIC_KEY:-}
export DRUPAL_SYNC_SSH_KNOWN_HOSTS=${DRUPAL_SYNC_SSH_KNOWN_HOSTS:-}

export DRUPAL_SYNC_SSH_USERNAME=${DRUPAL_SYNC_SSH_USERNAME:-}
export DRUPAL_SYNC_SSH_SERVER_HOST=${DRUPAL_SYNC_SSH_SERVER_HOST:-}
export DRUPAL_SYNC_SSH_SERVER_PORT=${DRUPAL_SYNC_SSH_SERVER_PORT:-22}
export DRUPAL_SYNC_DATABASE_FILENAME_GLOB=${DRUPAL_SYNC_DATABASE_FILENAME_GLOB:-}
export DATABASE_ARCHIVE_PATH=${DATABASE_ARCHIVE_PATH:-/tmp/database-backup.tar.gz}

export DRUPAL_INSTALL_PROFILE=${DRUPAL_INSTALL_PROFILE:-standard}
FORCE_DATABASE_DROP=${FORCE_DATABASE_DROP:-false}
FORCE_DATABASE_DROP="$(convert_to_boolean_string "$FORCE_DATABASE_DROP")"
export FORCE_DATABASE_DROP
INSTALL_DRUPAL=${INSTALL_DRUPAL:-true}
INSTALL_DRUPAL="$(convert_to_boolean_string "$INSTALL_DRUPAL")"
export INSTALL_DRUPAL

export DRUPAL_ADMIN_USERNAME=${DRUPAL_ADMIN_USERNAME:-drupal-continuous-pipe-admin}
export DRUPAL_ADMIN_PASSWORD=${DRUPAL_ADMIN_PASSWORD:-backdrop}

export TIDEWAYS_FRAMEWORK=${TIDEWAYS_FRAMEWORK:-drupal8}

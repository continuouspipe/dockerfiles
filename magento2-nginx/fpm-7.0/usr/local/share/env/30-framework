#!/bin/bash

export PHP_MEMORY_LIMIT=${PHP_MEMORY_LIMIT:-768M}

PRODUCTION_ENVIRONMENT=${PRODUCTION_ENVIRONMENT:-false}
PRODUCTION_ENVIRONMENT="$(convert_to_boolean_string "$PRODUCTION_ENVIRONMENT")"
export PRODUCTION_ENVIRONMENT

export APP_HOSTNAME=${APP_HOSTNAME:-magento.docker}
export PUBLIC_ADDRESS=${PUBLIC_ADDRESS:-https://magento.docker/}

FORCE_DATABASE_DROP=${FORCE_DATABASE_DROP:-false}
FORCE_DATABASE_DROP="$(convert_to_boolean_string "$FORCE_DATABASE_DROP")"
export FORCE_DATABASE_DROP
export DATABASE_ARCHIVE_PATH=${DATABASE_ARCHIVE_PATH:-tools/assets/development/magentodb.sql.gz}

export DATABASE_NAME=${DATABASE_NAME:-magentodb}
export DATABASE_USER=${DATABASE_USER:-magento}
export DATABASE_PASSWORD=${DATABASE_PASSWORD:-magento}
export DATABASE_ROOT_PASSWORD=${DATABASE_ROOT_PASSWORD:-magento}
export DATABASE_HOST=${DATABASE_HOST:-database}
export ADDITIONAL_SETUP_SQL=${ADDITIONAL_SETUP_SQL:-}

set +e
IS_HEM="$(is_hem_project)"
export IS_HEM
set -e
export HEM_RUN_ENV="${HEM_RUN_ENV:-local}"

export ASSET_ARCHIVE_PATH=${ASSET_ARCHIVE_PATH:-tools/assets/development/media.files.tgz}
export ASSET_DOWNLOAD_ENVIRONMENTS=${ASSET_DOWNLOAD_ENVIRONMENTS:-development}

export FRONTEND_INSTALL_DIRECTORY=${FRONTEND_INSTALL_DIRECTORY:-/app/tools/inviqa}
export FRONTEND_BUILD_DIRECTORY=${FRONTEND_BUILD_DIRECTORY:-/app/tools/inviqa}
export FRONTEND_BUILD_ACTION=${FRONTEND_BUILD_ACTION:-build}
export GULP_BUILD_THEME_NAME=${GULP_BUILD_THEME_NAME:-}

export MAGENTO_MODE=${MAGENTO_MODE:-production}
DEFAULT_MAGENTO_RUN_CODE_MAPPING="$APP_HOSTNAME default;"
export MAGENTO_RUN_CODE_MAPPING=${MAGENTO_RUN_CODE_MAPPING:-$DEFAULT_MAGENTO_RUN_CODE_MAPPING}
export MAGENTO_RUN_TYPE=${MAGENTO_RUN_TYPE:-store}

export FRONTEND_COMPILE_LANGUAGES=${FRONTEND_COMPILE_LANGUAGES:-en_GB}
export MAGENTO_DEPENDENCY_INJECTION_COMPILE_COMMAND=${MAGENTO_DEPENDENCY_INJECTION_COMPILE_COMMAND:-bin/magento setup:di:compile}

export MAGENTO_CRYPT_KEY=${MAGENTO_CRYPT_KEY:-}

export COMPOSER_CUSTOM_CONFIG_COMMAND=${COMPOSER_CUSTOM_CONFIG_COMMAND:-}

DEFAULT_COMPOSER_FLAGS="--no-interaction"
if [ -z "$DEVELOPMENT_MODE" ] || [ "$DEVELOPMENT_MODE" != "true" ]; then
  DEFAULT_COMPOSER_FLAGS="${DEFAULT_COMPOSER_FLAGS} --no-dev"
fi
export COMPOSER_INSTALL_FLAGS=${COMPOSER_INSTALL_FLAGS:-$DEFAULT_COMPOSER_FLAGS}

export MAGENTO_USE_REDIS=${MAGENTO_USE_REDIS:-true}
MAGENTO_USE_REDIS="$(convert_to_boolean_string "$MAGENTO_USE_REDIS")"
export REDIS_HOST=${REDIS_HOST:-redis}
export REDIS_HOST_PORT=${REDIS_HOST_PORT:-6379}
export MAGENTO_REDIS_CACHE_DATABASE=${MAGENTO_REDIS_CACHE_DATABASE:-0}
export MAGENTO_REDIS_FULL_PAGE_CACHE_DATABASE=${MAGENTO_REDIS_FULL_PAGE_CACHE_DATABASE:-1}
export MAGENTO_REDIS_SESSION_DATABASE=${MAGENTO_REDIS_SESSION_DATABASE:-2}

export MAGENTO_ADMIN_FRONTNAME=${MAGENTO_ADMIN_FRONTNAME:-admin}

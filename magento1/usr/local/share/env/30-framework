#!/bin/bash

export PHP_MEMORY_LIMIT=${PHP_MEMORY_LIMIT:-768M}
export WEB_DIRECTORY=${WEB_DIRECTORY:-public}
export MAGE_ROOT=${MAGE_ROOT:-${WEB_DIRECTORY}}

PRODUCTION_ENVIRONMENT=${PRODUCTION_ENVIRONMENT:-false}
PRODUCTION_ENVIRONMENT="$(convert_to_boolean_string "$PRODUCTION_ENVIRONMENT")"
export PRODUCTION_ENVIRONMENT

if [ -n "${APP_HOSTNAME:-}" ]; then
  echo 'deprecated: APP_HOSTNAME is deprecated, please use WEB_HOST instead' >&2
  export WEB_HOST="${APP_HOSTNAME}"
fi
export WEB_HOST=${WEB_HOST:-magento.docker}

FORCE_DATABASE_DROP=${FORCE_DATABASE_DROP:-false}
FORCE_DATABASE_DROP="$(convert_to_boolean_string "$FORCE_DATABASE_DROP")"
export FORCE_DATABASE_DROP
export DATABASE_ARCHIVE_PATH=${DATABASE_ARCHIVE_PATH:-tools/assets/development/magentodb.sql.gz}

export DATABASE_NAME=${DATABASE_NAME:-magentodb}
export DATABASE_USER=${DATABASE_USER:-magento}
export DATABASE_PASSWORD=${DATABASE_PASSWORD:-magento}
export DATABASE_HOST=${DATABASE_HOST:-database}
export ADDITIONAL_SETUP_SQL=${ADDITIONAL_SETUP_SQL:-}

export FRONTEND_INSTALL_DIRECTORY=${FRONTEND_INSTALL_DIRECTORY:-/app/tools/inviqa}
export FRONTEND_BUILD_DIRECTORY=${FRONTEND_BUILD_DIRECTORY:-/app/tools/inviqa}
export FRONTEND_BUILD_ACTION=${FRONTEND_BUILD_ACTION:-build}
export GULP_BUILD_THEME_NAME=${GULP_BUILD_THEME_NAME:-}

export MAGENTO_MODE=${MAGENTO_MODE:-production}
DEFAULT_MAGENTO_RUN_CODE_MAPPING="$APP_HOSTNAME default;"
export MAGENTO_RUN_CODE_MAPPING=${MAGENTO_RUN_CODE_MAPPING:-$DEFAULT_MAGENTO_RUN_CODE_MAPPING}

export MAGENTO_CRYPT_KEY=${MAGENTO_CRYPT_KEY:-}

deprecate_env_var MEMCACHED_HOST_PORT MEMCACHED_PORT

export MEMCACHED_HOST=${MEMCACHED_HOST:-memcached}
MEMCACHED_PORT="$(canonical_port "${MEMCACHED_PORT:-11211}")"
export MEMCACHED_PORT

deprecate_env_var REDIS_HOST_PORT REDIS_PORT

export REDIS_HOST=${REDIS_HOST:-redis}
REDIS_PORT="$(canonical_port "${REDIS_PORT:-6379}")"
export REDIS_PORT
export MAGENTO_REDIS_CACHE_DATABASE=${MAGENTO_REDIS_CACHE_DATABASE:-0}
export MAGENTO_REDIS_FULL_PAGE_CACHE_DATABASE=${MAGENTO_REDIS_FULL_PAGE_CACHE_DATABASE:-1}

export MAGENTO_ADMIN_FRONTNAME=${MAGENTO_ADMIN_FRONTNAME:-admin}

MAGENTO_CREATE_ADMIN_USER=${MAGENTO_CREATE_ADMIN_USER:-$DEVELOPMENT_MODE}
MAGENTO_CREATE_ADMIN_USER="$(convert_to_boolean_string_zero_is_true "$MAGENTO_CREATE_ADMIN_USER")"
export MAGENTO_CREATE_ADMIN_USER
export MAGENTO_ADMIN_USERNAME=${MAGENTO_ADMIN_USERNAME:-admin}
export MAGENTO_ADMIN_EMAIL=${MAGENTO_ADMIN_EMAIL:-admin@localhost}
export MAGENTO_ADMIN_PASSWORD=${MAGENTO_ADMIN_PASSWORD:-admin}
export MAGENTO_ADMIN_FORENAME=${MAGENTO_ADMIN_FORENAME:-AdminForename}
export MAGENTO_ADMIN_SURNAME=${MAGENTO_ADMIN_SURNAME:-AdminSurname}

export TIDEWAYS_FRAMEWORK=${TIDEWAYS_FRAMEWORK:-magento}
